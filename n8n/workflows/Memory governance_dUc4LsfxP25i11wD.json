{
  "updatedAt": "2026-01-07T20:13:24.168Z",
  "createdAt": "2025-12-29T18:50:25.303Z",
  "id": "dUc4LsfxP25i11wD",
  "name": "Memory governance",
  "description": null,
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "inputSource": "jsonExample",
        "jsonExample": "{\n  \"document\":\n    {\n      \"content\": \"The user is a software engineer\"\n    }\n}\n"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -208,
        -176
      ],
      "id": "039ec987-5dcd-4717-97a7-1bf2933e5cb0",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "d9aeb185-403d-4a57-b3a0-9208bc27ca13",
              "leftValue": "={{ $json.output[0].content[0].text.type }}",
              "rightValue": "ephemeral",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            },
            {
              "id": "e9135d40-b171-4672-8788-2574ccb2a944",
              "leftValue": "={{ $json.output[0].content[0].text.confidence }}",
              "rightValue": 0.75,
              "operator": {
                "type": "number",
                "operation": "gte"
              }
            },
            {
              "id": "ae1ff637-549a-47b2-ad4f-58186b4ecca9",
              "leftValue": "={{ $json.output[0].content[0].text.is_opinion }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            },
            {
              "id": "e7c463f5-1951-4503-9253-0974d61e2a93",
              "leftValue": "={{ $json.output[0].content[0].text.is_guess }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        816,
        -240
      ],
      "id": "76f9bf0c-3184-4c42-8e6a-81d5e115c840",
      "name": "Memory Gate"
    },
    {
      "parameters": {
        "jsCode": "return [{\n  pageContent: $('normalize data').first().json.normalized_text,\n  metadata: {\n    type: $input.first().json.output[0].content[0].text.type,\n    confidence: $input.first().json.output[0].content[0].text.confidence,\n    is_opinion: $('Message Classifier').first().json.output[0].content[0].text.is_opinion,\n    is_guess: $('Message Classifier').first().json.output[0].content[0].text.is_guess\n  }\n}]\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1040,
        -176
      ],
      "id": "e927d23a-db29-4282-b757-8cfc960cdde5",
      "name": "Document Mapper"
    },
    {
      "parameters": {
        "jsCode": "return {\n  rejected: true,\n  reason: 'Memory failed governance check',\n  details: {\n    type: $input.first().json.output[0].content[0].text.type,\n    confidence: $input.first().json.output[0].content[0].text.confidence,\n    is_opinion: $input.first().json.output[0].content[0].text.is_opinion,\n    is_guess: $input.first().json.output[0].content[0].text.is_guess\n  }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1040,
        -304
      ],
      "id": "f02498e8-39c4-4964-911b-206b1e8fcdc3",
      "name": "Rejection Output"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-5-nano",
          "mode": "list",
          "cachedResultName": "GPT-5-NANO"
        },
        "responses": {
          "values": [
            {
              "content": "=Classify the following memory candidate. Return JSON only, no explanations.\n\nMemory: \"{{ $json.normalized_text }}\"\n\nRules:\n- fact: stable, long-term truths about the user\n- preference: user likes/dislikes\n- skill: abilities or expertise\n- event: notable past occurrences\n- ephemeral: short-lived or conversational (reject these)\n- Opinions or guesses → is_opinion=true or is_guess=true\n"
            }
          ]
        },
        "builtInTools": {},
        "options": {
          "textFormat": {
            "textOptions": {
              "type": "json_schema",
              "schema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"type\": {\n      \"type\": \"string\",\n      \"enum\": [\"fact\", \"preference\", \"skill\", \"event\", \"ephemeral\"]\n    },\n    \"confidence\": {\n      \"type\": \"number\",\n      \"minimum\": 0,\n      \"maximum\": 1\n    },\n    \"is_opinion\": {\n      \"type\": \"boolean\"\n    },\n    \"is_guess\": {\n      \"type\": \"boolean\"\n    }\n  },\n  \"required\": [\"type\", \"confidence\", \"is_opinion\", \"is_guess\"],\n  \"additionalProperties\": false\n}\n"
            }
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 2.1,
      "position": [
        464,
        -240
      ],
      "id": "7fc5ee73-0958-4b06-a99d-5d53dbe4879a",
      "name": "Message Classifier",
      "credentials": {
        "openAiApi": {
          "id": "JAXAQJQgf0B0XCnc",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "return {\n  normalized_text: $input.first().json.document.content\n    .toLowerCase()\n    .replace(/\\s+/g, ' ')\n    .trim()\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        16,
        -160
      ],
      "id": "1ce95e3f-8dfa-4efd-afd3-7641e9f5b5ec",
      "name": "normalize data"
    }
  ],
  "connections": {
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "normalize data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Memory Gate": {
      "main": [
        [
          {
            "node": "Document Mapper",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Rejection Output",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Document Mapper": {
      "main": [
        []
      ]
    },
    "Message Classifier": {
      "main": [
        [
          {
            "node": "Memory Gate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "normalize data": {
      "main": [
        [
          {
            "node": "Message Classifier",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {
    "When Executed by Another Workflow": [
      {
        "json": {
          "document": {
            "content": "the user works at payoneer"
          },
          "governance": true
        }
      }
    ]
  },
  "versionId": "8fdf31b5-7522-45aa-85c9-b322fe1537b1",
  "activeVersionId": "8fdf31b5-7522-45aa-85c9-b322fe1537b1",
  "versionCounter": 66,
  "triggerCount": 0,
  "shared": [
    {
      "updatedAt": "2025-12-29T18:50:25.304Z",
      "createdAt": "2025-12-29T18:50:25.304Z",
      "role": "workflow:owner",
      "workflowId": "dUc4LsfxP25i11wD",
      "projectId": "cyBU0P25SZASl1ZF",
      "project": {
        "updatedAt": "2025-12-17T07:41:57.804Z",
        "createdAt": "2025-12-17T07:35:20.908Z",
        "id": "cyBU0P25SZASl1ZF",
        "name": "Amir Kakon <pppchevy@gmail.com>",
        "type": "personal",
        "icon": null,
        "description": null,
        "projectRelations": [
          {
            "updatedAt": "2025-12-17T07:35:20.908Z",
            "createdAt": "2025-12-17T07:35:20.908Z",
            "userId": "045524f4-1d37-4cdf-9c9b-f566c48b5fbd",
            "projectId": "cyBU0P25SZASl1ZF",
            "user": {
              "updatedAt": "2026-01-07T18:05:41.000Z",
              "createdAt": "2025-12-17T07:35:20.329Z",
              "id": "045524f4-1d37-4cdf-9c9b-f566c48b5fbd",
              "email": "pppchevy@gmail.com",
              "firstName": "Amir",
              "lastName": "Kakon",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-12-17T07:42:13.516Z",
                "personalization_survey_n8n_version": "2.0.2",
                "companyType": "personal",
                "reportedSource": "youtube"
              },
              "settings": {
                "userActivated": true,
                "firstSuccessfulWorkflowId": "dJmq3O0s7lDAMANm",
                "userActivatedAt": 1766675621429,
                "easyAIWorkflowOnboarded": true,
                "npsSurvey": {
                  "waitingForResponse": true,
                  "ignoredCount": 2,
                  "lastShownAt": 1767600020939
                }
              },
              "disabled": false,
              "mfaEnabled": false,
              "lastActiveAt": "2026-01-07",
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": [],
  "activeVersion": {
    "updatedAt": "2026-01-07T19:49:27.937Z",
    "createdAt": "2026-01-07T19:49:27.937Z",
    "versionId": "8fdf31b5-7522-45aa-85c9-b322fe1537b1",
    "workflowId": "dUc4LsfxP25i11wD",
    "nodes": [
      {
        "parameters": {
          "inputSource": "jsonExample",
          "jsonExample": "{\n  \"document\":\n    {\n      \"content\": \"The user is a software engineer\"\n    }\n}\n"
        },
        "type": "n8n-nodes-base.executeWorkflowTrigger",
        "typeVersion": 1.1,
        "position": [
          -208,
          -176
        ],
        "id": "039ec987-5dcd-4717-97a7-1bf2933e5cb0",
        "name": "When Executed by Another Workflow"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "d9aeb185-403d-4a57-b3a0-9208bc27ca13",
                "leftValue": "={{ $json.output[0].content[0].text.type }}",
                "rightValue": "ephemeral",
                "operator": {
                  "type": "string",
                  "operation": "notEquals"
                }
              },
              {
                "id": "e9135d40-b171-4672-8788-2574ccb2a944",
                "leftValue": "={{ $json.output[0].content[0].text.confidence }}",
                "rightValue": 0.75,
                "operator": {
                  "type": "number",
                  "operation": "gte"
                }
              },
              {
                "id": "ae1ff637-549a-47b2-ad4f-58186b4ecca9",
                "leftValue": "={{ $json.output[0].content[0].text.is_opinion }}",
                "rightValue": false,
                "operator": {
                  "type": "boolean",
                  "operation": "equals"
                }
              },
              {
                "id": "e7c463f5-1951-4503-9253-0974d61e2a93",
                "leftValue": "={{ $json.output[0].content[0].text.is_guess }}",
                "rightValue": false,
                "operator": {
                  "type": "boolean",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          816,
          -240
        ],
        "id": "76f9bf0c-3184-4c42-8e6a-81d5e115c840",
        "name": "Memory Gate"
      },
      {
        "parameters": {
          "jsCode": "return [{\n  pageContent: $('normalize data').first().json.normalized_text,\n  metadata: {\n    type: $input.first().json.output[0].content[0].text.type,\n    confidence: $input.first().json.output[0].content[0].text.confidence,\n    is_opinion: $('Message Classifier').first().json.output[0].content[0].text.is_opinion,\n    is_guess: $('Message Classifier').first().json.output[0].content[0].text.is_guess\n  }\n}]\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1040,
          -176
        ],
        "id": "e927d23a-db29-4282-b757-8cfc960cdde5",
        "name": "Document Mapper"
      },
      {
        "parameters": {
          "jsCode": "return {\n  rejected: true,\n  reason: 'Memory failed governance check',\n  details: {\n    type: $input.first().json.output[0].content[0].text.type,\n    confidence: $input.first().json.output[0].content[0].text.confidence,\n    is_opinion: $input.first().json.output[0].content[0].text.is_opinion,\n    is_guess: $input.first().json.output[0].content[0].text.is_guess\n  }\n};\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1040,
          -304
        ],
        "id": "f02498e8-39c4-4964-911b-206b1e8fcdc3",
        "name": "Rejection Output"
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-5-nano",
            "mode": "list",
            "cachedResultName": "GPT-5-NANO"
          },
          "responses": {
            "values": [
              {
                "content": "=Classify the following memory candidate. Return JSON only, no explanations.\n\nMemory: \"{{ $json.normalized_text }}\"\n\nRules:\n- fact: stable, long-term truths about the user\n- preference: user likes/dislikes\n- skill: abilities or expertise\n- event: notable past occurrences\n- ephemeral: short-lived or conversational (reject these)\n- Opinions or guesses → is_opinion=true or is_guess=true\n"
              }
            ]
          },
          "builtInTools": {},
          "options": {
            "textFormat": {
              "textOptions": {
                "type": "json_schema",
                "schema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"type\": {\n      \"type\": \"string\",\n      \"enum\": [\"fact\", \"preference\", \"skill\", \"event\", \"ephemeral\"]\n    },\n    \"confidence\": {\n      \"type\": \"number\",\n      \"minimum\": 0,\n      \"maximum\": 1\n    },\n    \"is_opinion\": {\n      \"type\": \"boolean\"\n    },\n    \"is_guess\": {\n      \"type\": \"boolean\"\n    }\n  },\n  \"required\": [\"type\", \"confidence\", \"is_opinion\", \"is_guess\"],\n  \"additionalProperties\": false\n}\n"
              }
            }
          }
        },
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 2.1,
        "position": [
          464,
          -240
        ],
        "id": "7fc5ee73-0958-4b06-a99d-5d53dbe4879a",
        "name": "Message Classifier",
        "credentials": {
          "openAiApi": {
            "id": "JAXAQJQgf0B0XCnc",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "return {\n  normalized_text: $input.first().json.document.content\n    .toLowerCase()\n    .replace(/\\s+/g, ' ')\n    .trim()\n};\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          16,
          -160
        ],
        "id": "1ce95e3f-8dfa-4efd-afd3-7641e9f5b5ec",
        "name": "normalize data"
      }
    ],
    "connections": {
      "When Executed by Another Workflow": {
        "main": [
          [
            {
              "node": "normalize data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Memory Gate": {
        "main": [
          [
            {
              "node": "Document Mapper",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Rejection Output",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Document Mapper": {
        "main": [
          []
        ]
      },
      "Message Classifier": {
        "main": [
          [
            {
              "node": "Memory Gate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "normalize data": {
        "main": [
          [
            {
              "node": "Message Classifier",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Amir Kakon",
    "name": null,
    "description": null,
    "workflowPublishHistory": [
      {
        "createdAt": "2026-01-07T19:49:27.964Z",
        "id": 86,
        "workflowId": "dUc4LsfxP25i11wD",
        "versionId": "8fdf31b5-7522-45aa-85c9-b322fe1537b1",
        "event": "activated",
        "userId": "045524f4-1d37-4cdf-9c9b-f566c48b5fbd"
      },
      {
        "createdAt": "2026-01-07T19:49:29.462Z",
        "id": 87,
        "workflowId": "dUc4LsfxP25i11wD",
        "versionId": "8fdf31b5-7522-45aa-85c9-b322fe1537b1",
        "event": "activated",
        "userId": "045524f4-1d37-4cdf-9c9b-f566c48b5fbd"
      },
      {
        "createdAt": "2026-01-07T20:08:50.149Z",
        "id": 106,
        "workflowId": "dUc4LsfxP25i11wD",
        "versionId": "8fdf31b5-7522-45aa-85c9-b322fe1537b1",
        "event": "activated",
        "userId": "045524f4-1d37-4cdf-9c9b-f566c48b5fbd"
      },
      {
        "createdAt": "2026-01-07T20:08:52.443Z",
        "id": 107,
        "workflowId": "dUc4LsfxP25i11wD",
        "versionId": "8fdf31b5-7522-45aa-85c9-b322fe1537b1",
        "event": "activated",
        "userId": "045524f4-1d37-4cdf-9c9b-f566c48b5fbd"
      },
      {
        "createdAt": "2026-01-07T20:13:24.191Z",
        "id": 126,
        "workflowId": "dUc4LsfxP25i11wD",
        "versionId": "8fdf31b5-7522-45aa-85c9-b322fe1537b1",
        "event": "activated",
        "userId": "045524f4-1d37-4cdf-9c9b-f566c48b5fbd"
      },
      {
        "createdAt": "2026-01-07T20:13:25.340Z",
        "id": 127,
        "workflowId": "dUc4LsfxP25i11wD",
        "versionId": "8fdf31b5-7522-45aa-85c9-b322fe1537b1",
        "event": "activated",
        "userId": "045524f4-1d37-4cdf-9c9b-f566c48b5fbd"
      }
    ]
  }
}